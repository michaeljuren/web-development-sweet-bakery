<div class="container">
  <header class="page-header">
    <h1 class="page-title">
      <span class="checkout-icon">ðŸ›’</span>
      Checkout
    </h1>
    <p class="page-subtitle">Complete your order in just a few simple steps</p>
  </header>

  <div class="checkout-content">
    <!-- Order Summary Section -->
    <div class="order-summary-section">
      <div class="summary-card">
        <h2 class="section-title">
          <i class="fas fa-shopping-bag"></i>
          Order Summary
        </h2>

        <div *ngIf="cartItems.length === 0" class="empty-cart">
          <i class="fas fa-shopping-cart"></i>
          <p>Your cart is empty</p>
          <button class="back-btn" (click)="navigateToOrder()">
            <i class="fas fa-arrow-left"></i>
            Back to Order page
          </button>
        </div>

        <div *ngIf="cartItems.length > 0">
          <div class="cart-items">
            <div class="cart-item" *ngFor="let item of cartItems">
              <div class="item-info">
                <div class="item-name">{{ item.name }}</div>
                <div class="item-details">Qty: {{ item.qty }} Ã— R{{ item.price.toFixed(2) }}</div>
              </div>
              <div class="item-total">R{{ (item.price * item.qty).toFixed(2) }}</div>
            </div>
          </div>

          <div class="order-totals">
            <div class="total-row">
              <span>Subtotal:</span>
              <span>R{{ subtotal.toFixed(2) }}</span>
            </div>
            <div class="total-row">
              <span>Tax (15%):</span>
              <span>R{{ tax.toFixed(2) }}</span>
            </div>
            <div class="total-row highlight">
              <span>Total:</span>
              <span>R{{ total.toFixed(2) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Checkout Form Section -->
    <div class="checkout-form-section" *ngIf="cartItems.length > 0">
      <form class="checkout-form" (ngSubmit)="submitOrder()" #checkoutForm="ngForm">
        <!-- Contact Information -->
        <div class="form-section">
          <h3 class="form-section-title">
            <i class="fas fa-user"></i>
            Contact Information
          </h3>
          <div class="form-row">
            <div class="form-group full-width">
              <label for="fullName">Full Name *</label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                [(ngModel)]="checkoutData.fullName"
                required
                placeholder="John Doe"
                [class.error]="checkoutForm.submitted && !checkoutData.fullName"
              />
              <span class="error-message" *ngIf="checkoutForm.submitted && !checkoutData.fullName">
                Full name is required
              </span>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input
                type="email"
                id="email"
                name="email"
                [(ngModel)]="checkoutData.email"
                required
                email
                placeholder="john@example.com"
                [class.error]="checkoutForm.submitted && !checkoutData.email"
              />
              <span class="error-message" *ngIf="checkoutForm.submitted && !checkoutData.email">
                Valid email is required
              </span>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input
                type="tel"
                id="phone"
                name="phone"
                [(ngModel)]="checkoutData.phone"
                required
                placeholder="(555) 123-4567"
                [class.error]="checkoutForm.submitted && !checkoutData.phone"
              />
              <span class="error-message" *ngIf="checkoutForm.submitted && !checkoutData.phone">
                Phone number is required
              </span>
            </div>
          </div>
        </div>

        <!-- Delivery Method -->
        <div class="form-section">
          <h3 class="form-section-title">
            <i class="fas fa-truck"></i>
            Delivery Method
          </h3>
          <div class="delivery-options">
            <label class="delivery-option" [class.selected]="checkoutData.deliveryMethod === 'pickup'">
              <input
                type="radio"
                name="deliveryMethod"
                value="pickup"
                [(ngModel)]="checkoutData.deliveryMethod"
                required
              />
              <div class="option-content">
                <i class="fas fa-store"></i>
                <div>
                  <div class="option-title">Pickup</div>
                  <div class="option-description">Collect from our bakery</div>
                </div>
              </div>
            </label>
            <label class="delivery-option" [class.selected]="checkoutData.deliveryMethod === 'delivery'">
              <input
                type="radio"
                name="deliveryMethod"
                value="delivery"
                [(ngModel)]="checkoutData.deliveryMethod"
                required
              />
              <div class="option-content">
                <i class="fas fa-shipping-fast"></i>
                <div>
                  <div class="option-title">Delivery</div>
                  <div class="option-description">We'll deliver to you</div>
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Delivery Address (if delivery selected) -->
        <div class="form-section" *ngIf="checkoutData.deliveryMethod === 'delivery'">
          <h3 class="form-section-title">
            <i class="fas fa-map-marker-alt"></i>
            Delivery Address
          </h3>
          <div class="form-row">
            <div class="form-group full-width">
              <label for="address">Street Address *</label>
              <input
                type="text"
                id="address"
                name="address"
                [(ngModel)]="checkoutData.address"
                [required]="checkoutData.deliveryMethod === 'delivery'"
                placeholder="123 Main Street"
              />
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="city">City *</label>
              <input
                type="text"
                id="city"
                name="city"
                [(ngModel)]="checkoutData.city"
                [required]="checkoutData.deliveryMethod === 'delivery'"
                placeholder="Cape Town"
              />
            </div>
            <div class="form-group">
              <label for="zipCode">Postal Code *</label>
              <input
                type="text"
                id="zipCode"
                name="zipCode"
                [(ngModel)]="checkoutData.zipCode"
                [required]="checkoutData.deliveryMethod === 'delivery'"
                placeholder="8001"
              />
            </div>
          </div>
        </div>

        <!-- Pickup Date & Time -->
        <div class="form-section">
          <h3 class="form-section-title">
            <i class="fas fa-clock"></i>
            {{ checkoutData.deliveryMethod === 'delivery' ? 'Delivery' : 'Pickup' }} Date & Time
          </h3>
          <div class="form-row">
            <div class="form-group">
              <label for="date">Date *</label>
              <input
                type="date"
                id="date"
                name="date"
                [(ngModel)]="checkoutData.date"
                required
                [min]="minDate"
              />
            </div>
            <div class="form-group">
              <label for="time">Time *</label>
              <select
                id="time"
                name="time"
                [(ngModel)]="checkoutData.time"
                required
              >
                <option value="">Select time</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Special Instructions -->
        <div class="form-section">
          <h3 class="form-section-title">
            <i class="fas fa-comment"></i>
            Special Instructions
          </h3>
          <div class="form-row">
            <div class="form-group full-width">
              <label for="notes">Order Notes (Optional)</label>
              <textarea
                id="notes"
                name="notes"
                [(ngModel)]="checkoutData.notes"
                rows="4"
                placeholder="Any special requests or dietary requirements?"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="button" class="cancel-btn" (click)="navigateToOrder()">
            <i class="fas fa-arrow-left"></i>
            Back to Menu
          </button>
          <button type="submit" class="submit-btn">
            <i class="fas fa-check-circle"></i>
            Place Order
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal-overlay" *ngIf="showSuccessModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-icon success">
      <i class="fas fa-check-circle"></i>
    </div>
    <h2>Order Confirmed!</h2>
    <p>Thank you for your order, {{ checkoutData.fullName }}!</p>
    <p class="order-number">Order #{{ orderNumber }}</p>
    <p class="confirmation-text">
      We've sent a confirmation email to <strong>{{ checkoutData.email }}</strong>
    </p>
    <p class="pickup-info">
      {{ checkoutData.deliveryMethod === 'delivery' ? 'Delivery' : 'Pickup' }} scheduled for:
      <strong>{{ checkoutData.date }} at {{ checkoutData.time }}</strong>
    </p>
    <button class="modal-btn" (click)="closeModalAndNavigate()">
      <i class="fas fa-home"></i>
      Back to Home
    </button>
  </div>
</div>
